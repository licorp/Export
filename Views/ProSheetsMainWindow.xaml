<Window x:Class="ProSheetsAddin.Views.ProSheetsMainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ProSheetsAddin.Views"
        Title="Export + - Batch export to PDF, DWG, IFC, etc."
        Width="900" Height="600"
        ResizeMode="CanResize"
        WindowStartupLocation="CenterScreen"
        Background="#F0F0F0">

    <Window.Resources>
        <!-- Button Styles -->
        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="3"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#106EBE"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#005A9E"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#F3F2F1"/>
            <Setter Property="Foreground" Value="#323130"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="BorderBrush" Value="#8A8886"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#EDEBE9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Format Button Style -->
        <Style x:Key="FormatButtonStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="80"/>
            <Setter Property="Height" Value="80"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="5">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="{TemplateBinding Content}" 
                                           Width="40" Height="40"
                                           FontSize="16" FontWeight="Bold"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           TextAlignment="Center"/>
                                <TextBlock Text="{TemplateBinding Content}" 
                                           FontSize="11" 
                                           FontWeight="Bold"
                                           HorizontalAlignment="Center"
                                           Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="BorderBrush" Value="#0078D4"/>
                                <Setter Property="Background" Value="#F3F9FF"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#0078D4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with Profile Selection -->
        <Border Grid.Row="0" Background="White" BorderBrush="#E1E1E1" BorderThickness="0,0,0,1" Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Logo and Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="🏗️" FontSize="32" Margin="0,0,10,0" VerticalAlignment="Center"/>
                    <TextBlock Text="Export +" 
                               FontSize="20" 
                               FontWeight="Bold" 
                               VerticalAlignment="Center"
                               Foreground="#0078D4"/>
                </StackPanel>

                <!-- Profile Selection -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <TextBlock Text="Profile:" 
                               VerticalAlignment="Center" 
                               Margin="0,0,8,0"/>
                    <ComboBox Name="ProfileComboBox" 
                              Width="150" 
                              Height="30"
                              SelectionChanged="ProfileComboBox_SelectionChanged"/>
                    <Button Content="+" 
                            Width="30" Height="30"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Margin="5,0,0,0"
                            Click="AddProfile_Click"
                            ToolTip="Create new profile"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <TabControl Grid.Row="1" 
                    Name="MainTabControl"
                    Background="Transparent"
                    BorderThickness="0"
                    Margin="0"
                    SelectionChanged="TabControl_SelectionChanged">
            <!-- Sheets Tab -->
            <TabItem Header="Sheets" FontSize="14">
                <Grid Margin="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="3*"/>
                        <ColumnDefinition Width="1*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Sheets List -->
                    <GroupBox Grid.Column="0" Header="Select sheets to export" Margin="0,0,10,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Filter Controls -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                <RadioButton Name="SheetsRadio" Content="Sheets" IsChecked="True" Margin="0,0,15,0"/>
                                <RadioButton Name="ViewsRadio" Content="Views" Margin="0,0,15,0"/>
                                <ComboBox Name="ViewTypeCombo" Width="150" Margin="0,0,15,0">
                                    <ComboBoxItem Content="All Views"/>
                                    <ComboBoxItem Content="Floor Plans"/>
                                    <ComboBoxItem Content="Elevations"/>
                                    <ComboBoxItem Content="Sections"/>
                                    <ComboBoxItem Content="3D Views"/>
                                </ComboBox>
                                <Button Content="Toggle All" 
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Click="ToggleAll_Click"/>
                            </StackPanel>

                            <!-- Sheets DataGrid -->
                            <DataGrid Grid.Row="1" 
                                      Name="SheetsDataGrid"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      CanUserDeleteRows="False"
                                      GridLinesVisibility="Horizontal"
                                      HeadersVisibility="Column"
                                      SelectionMode="Extended"
                                      AlternatingRowBackground="#F9F9F9"
                                      RowHeaderWidth="0"
                                      ItemsSource="{Binding SheetItems}"
                                      PreviewMouseLeftButtonDown="SheetsDataGrid_PreviewMouseLeftButtonDown"
                                      CellEditEnding="SheetsDataGrid_CellEditEnding"
                                      SelectionChanged="SheetsDataGrid_SelectionChanged">
                                <DataGrid.Columns>
                                    <DataGridCheckBoxColumn Header="" 
                                                            Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                                            Width="30"/>
                                    <DataGridTextColumn Header="Sheet Number" 
                                                        Binding="{Binding Number}"
                                                        Width="100"/>
                                    <DataGridTextColumn Header="Sheet Name" 
                                                        Binding="{Binding Name}"
                                                        Width="*"/>
                                    <DataGridTextColumn Header="Custom Drawing Number" 
                                                        Binding="{Binding CustomDrawingNumber}"
                                                        Width="200"/>
                                </DataGrid.Columns>
                            </DataGrid>

                            <!-- Sheet Count -->
                            <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,10,0,0">
                                <TextBlock Name="SheetCountLabel" 
                                           Text="{Binding SelectedSheetsCount, StringFormat='{}Đã chọn {0} sheets'}"/>
                                <TextBlock Text=" | " Margin="10,0"/>
                                <Button Content="Edit Custom Drawing Number" 
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Click="EditCustomDrawingNumber_Click"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!-- Right Panel - Sheet Settings -->
                    <GroupBox Grid.Column="1" Header="Sheet settings">
                        <StackPanel>
                            <!-- Paper Size -->
                            <TextBlock Text="Paper size:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ComboBox Name="PaperSizeCombo" Margin="0,0,0,15">
                                <ComboBoxItem Content="Auto"/>
                                <ComboBoxItem Content="A0"/>
                                <ComboBoxItem Content="A1"/>
                                <ComboBoxItem Content="A2"/>
                                <ComboBoxItem Content="A3"/>
                                <ComboBoxItem Content="A4"/>
                            </ComboBox>

                            <!-- Orientation -->
                            <TextBlock Text="Orientation:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ComboBox Name="OrientationCombo" Margin="0,0,0,15">
                                <ComboBoxItem Content="Auto"/>
                                <ComboBoxItem Content="Portrait"/>
                                <ComboBoxItem Content="Landscape"/>
                            </ComboBox>

                            <!-- Options -->
                            <CheckBox Content="Place drawing on center" IsChecked="{Binding PaperPlacement, Converter={x:Static local:EnumToBooleanConverter.Instance}, ConverterParameter=Center}" Margin="0,0,0,5"/>
                            <CheckBox Content="Zoom to 100%" Margin="0,0,0,5"/>
                            <CheckBox Content="Hide crop regions" IsChecked="{Binding HideCropBoundaries}" Margin="0,0,0,5"/>
                            <CheckBox Content="Hide scope boxes" IsChecked="{Binding HideScopeBoxes}" Margin="0,0,0,15"/>

                            <!-- File Location -->
                            <TextBlock Text="File location:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox Name="FileLocationBox" Height="25" Margin="0,0,0,5" 
                                     Text="{Binding OutputFolder, UpdateSourceTrigger=PropertyChanged}"/>
                            <Button Content="Browse..." 
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    HorizontalAlignment="Left"
                                    Click="BrowseFolder_Click"/>
                        </StackPanel>
                    </GroupBox>
                </Grid>
            </TabItem>
            <!-- Formats Tab -->
            <TabItem Header="Formats" FontSize="14">
                <ScrollViewer Padding="20">
                    <StackPanel>
                        <TextBlock Text="Select export formats" 
                                   FontSize="16" 
                                   FontWeight="Bold" 
                                   Margin="0,0,0,20"/>

                        <WrapPanel Name="FormatsPanel">
                            <!-- PDF Format -->
                            <ToggleButton Name="PDFToggle" 
                                          Content="PDF" 
                                          Style="{StaticResource FormatButtonStyle}"
                                          IsChecked="{Binding IsPdfSelected}"
                                          Checked="FormatToggle_Checked"
                                          Unchecked="FormatToggle_Unchecked"
                                          Tag="PDF"/>

                            <!-- DWG Format -->
                            <ToggleButton Name="DWGToggle" 
                                          Content="DWG" 
                                          Style="{StaticResource FormatButtonStyle}"
                                          IsChecked="{Binding IsDwgSelected}"
                                          Checked="FormatToggle_Checked"
                                          Unchecked="FormatToggle_Unchecked"
                                          Tag="DWG"/>

                            <!-- DGN Format -->
                            <ToggleButton Name="DGNToggle" 
                                          Content="DGN" 
                                          Style="{StaticResource FormatButtonStyle}"
                                          IsChecked="{Binding IsDgnSelected}"
                                          Checked="FormatToggle_Checked"
                                          Unchecked="FormatToggle_Unchecked"
                                          Tag="DGN"/>

                            <!-- IFC Format -->
                            <ToggleButton Name="IFCToggle" 
                                          Content="IFC" 
                                          Style="{StaticResource FormatButtonStyle}"
                                          IsChecked="{Binding IsIfcSelected}"
                                          Checked="FormatToggle_Checked"
                                          Unchecked="FormatToggle_Unchecked"
                                          Tag="IFC"/>

                            <!-- IMG Format -->
                            <ToggleButton Name="IMGToggle" 
                                          Content="IMG" 
                                          Style="{StaticResource FormatButtonStyle}"
                                          IsChecked="{Binding IsImgSelected}"
                                          Checked="FormatToggle_Checked"
                                          Unchecked="FormatToggle_Unchecked"
                                          Tag="IMG"/>
                        </WrapPanel>

                        <!-- Format Settings Panel -->
                        <Border Name="FormatSettingsPanel" 
                                Background="White" 
                                BorderBrush="#E1E1E1" 
                                BorderThickness="1"
                                CornerRadius="3"
                                Padding="20"
                                Margin="0,20,0,0"
                                Visibility="Visible">
                            
                            <!-- PDF Settings (shown by default) -->
                            <StackPanel Name="PDFSettings">
                                <TextBlock Text="PDF Settings" 
                                           FontSize="14" 
                                           FontWeight="Bold" 
                                           Margin="0,0,0,15"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0" Margin="0,0,20,0">
                                        <CheckBox Content="Combine multiple sheets in one PDF file" 
                                                  Name="CombinePDFCheck" 
                                                  IsChecked="{Binding CombineFiles}"
                                                  Margin="0,0,0,10"/>
                                        <CheckBox Content="Always use print settings" 
                                                  IsChecked="True" 
                                                  Margin="0,0,0,10"/>
                                        <CheckBox Content="Include non-printing objects" 
                                                  Margin="0,0,0,10"/>
                                        <CheckBox Content="Export linked files" 
                                                  Margin="0,0,0,10"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="Quality:" Margin="0,0,0,5"/>
                                        <ComboBox Name="PDFQualityCombo" Margin="0,0,0,10" 
                                                  SelectedValue="{Binding RasterQuality}">
                                            <ComboBoxItem Content="150 DPI" Tag="Medium"/>
                                            <ComboBoxItem Content="300 DPI" Tag="High"/>
                                            <ComboBoxItem Content="600 DPI" Tag="Maximum"/>
                                        </ComboBox>
                                        
                                        <TextBlock Text="Colors:" Margin="0,0,0,5"/>
                                        <ComboBox Name="PDFColorsCombo" Margin="0,0,0,10"
                                                  SelectedValue="{Binding Colors}">
                                            <ComboBoxItem Content="Color" Tag="Color"/>
                                            <ComboBoxItem Content="Grayscale" Tag="Grayscale"/>
                                            <ComboBoxItem Content="Black lines" Tag="BlackAndWhite"/>
                                        </ComboBox>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            <!-- Create Tab -->
            <TabItem Header="Create" FontSize="14">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Export Summary -->
                    <Border Grid.Row="0" 
                            Background="#F8F8F8" 
                            BorderBrush="#E1E1E1" 
                            BorderThickness="1"
                            CornerRadius="3"
                            Padding="20"
                            Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Export Summary" 
                                       FontSize="16" 
                                       FontWeight="Bold" 
                                       Margin="0,0,0,10"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Sheets selected:" FontWeight="Bold" Margin="0,0,10,5"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Name="SelectedSheetsLabel" Text="{Binding SelectedSheetsCount}" Margin="0,0,0,5"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Export formats:" FontWeight="Bold" Margin="0,0,10,5"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Name="SelectedFormatsLabel" Text="{Binding SelectedFormats, Converter={x:Static local:FormatListConverter.Instance}}" Margin="0,0,0,5"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Output folder:" FontWeight="Bold" Margin="0,0,10,5"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Name="OutputFolderLabel" Text="{Binding OutputFolder}" Margin="0,0,0,5"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Estimated files:" FontWeight="Bold" Margin="0,0,10,5"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" Name="EstimatedFilesLabel" Text="0" Margin="0,0,0,5"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Export Options -->
                    <StackPanel Grid.Row="1">
                        <CheckBox Content="Save all files in the same folder location" 
                                  IsChecked="{Binding CreateSeparateFolders, Converter={x:Static local:InverseBooleanConverter.Instance}}" 
                                  Margin="0,0,0,10"/>
                        <CheckBox Content="Open folder when process completes" 
                                  IsChecked="True" 
                                  Margin="0,0,0,10"/>
                        <CheckBox Content="Save report to Excel" 
                                  Name="SaveReportCheck"
                                  IsChecked="True" 
                                  Margin="0,0,0,20"/>
                    </StackPanel>

                    <!-- Create Button -->
                    <Button Grid.Row="2"
                            Name="CreateButton"
                            Content="CREATE"
                            Style="{StaticResource PrimaryButtonStyle}"
                            HorizontalAlignment="Center"
                            Padding="40,12"
                            FontSize="16"
                            Click="Create_Click"/>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Status Bar -->
        <StatusBar Grid.Row="2" 
                   Background="White" 
                   BorderBrush="#E1E1E1" 
                   BorderThickness="0,1,0,0">
            <StatusBarItem>
                <TextBlock Name="StatusLabel" Text="Ready" FontSize="12"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="Export + v2.1.0 by DiRoots (Enhanced Vietnamese Version)" FontSize="12" Foreground="#666"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Text="Enhanced version với full functionality - Use DebugView to see logs" FontSize="12" Foreground="#666"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
