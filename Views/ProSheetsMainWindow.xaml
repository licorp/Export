<Window x:Class="ProSheetsAddin.Views.ProSheetsMainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ProSheetsAddin"
        Title="Export +" 
        Height="750" Width="1200"
        MinHeight="600" MinWidth="800"
        WindowStartupLocation="CenterScreen"
        ShowInTaskbar="True"
        Topmost="False"
        WindowState="Normal"
        ResizeMode="CanResize"
        DataContext="{Binding RelativeSource={RelativeSource Self}}">

    <Window.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- Professional Button Styles -->
        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#2196F3"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#2196F3"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"
                                              Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1976D2"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#1565C0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="BorderBrush" Value="#E1E1E1"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"
                                              Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F5F5F5"/>
                                <Setter Property="BorderBrush" Value="#CCCCCC"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#EEEEEE"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- DataGrid Styles -->
        <Style x:Key="HeaderlessDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E1E1E1"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#F0F0F0"/>
            <Setter Property="RowHeight" Value="35"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="SelectionMode" Value="Extended"/>
            <Setter Property="AlternatingRowBackground" Value="#FAFAFA"/>
        </Style>

        <Style x:Key="CustomHeaderTextBlock" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="10,8"/>
        </Style>
        
        <!-- Custom File Name Column Header Style (darker background) -->
        <Style x:Key="CustomFileNameHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#E8E8E8"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
        </Style>
    </Window.Resources>

    <Grid Background="#FAFAFA">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Main Content -->
        <TabControl x:Name="MainTabControl" Grid.Row="0" Background="White" BorderThickness="0"
                    SelectionChanged="MainTabControl_SelectionChanged">
            <!-- Sheets Tab -->
            <TabItem x:Name="SheetsTab">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Fill="#4CAF50" Width="8" Height="8" Margin="0,0,5,0"/>
                        <TextBlock Text="Sheets"/>
                    </StackPanel>
                </TabItem.Header>
                
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Profile Manager Bar -->
                    <Border Grid.Row="0" Background="#F8F8F8" BorderBrush="#E1E1E1" BorderThickness="1" 
                            CornerRadius="3" Padding="15" Margin="0,15,0,15">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Label bên trái -->
                            <TextBlock Grid.Column="0" Text="Profile:" VerticalAlignment="Center" 
                                       Margin="0,0,10,0" FontWeight="SemiBold" FontSize="14"/>
                            
                            <!-- ComboBox giữa -->
                            <ComboBox Grid.Column="1" x:Name="ProfileComboBox" Height="32" 
                                      MinWidth="200" MaxWidth="400" HorizontalAlignment="Stretch"
                                      Margin="0,0,10,0"
                                      ItemsSource="{Binding Profiles}"
                                      SelectedItem="{Binding SelectedProfile}"
                                      DisplayMemberPath="ProfileName"
                                      SelectionChanged="ProfileComboBox_SelectionChanged"/>
                            
                            <!-- Buttons bên phải -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                <Button Content="Add" Width="80" Height="32" Margin="0,0,8,0" 
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        ToolTip="Import profile from JSON file"
                                        Click="ImportProfile_Click"/>
                                <Button Content="Save" Width="80" Height="32" Margin="0,0,8,0"
                                        Style="{StaticResource SecondaryButtonStyle}" 
                                        ToolTip="Export profile to JSON file"
                                        Click="ExportProfile_Click"/>
                                <Button Content="Del" Width="80" Height="32" Margin="0,0,0,0"
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        ToolTip="Delete current profile"
                                        Click="DeleteProfile_Click"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Top Control Bar - Ribbon -->
                    <Border Grid.Row="1" Background="White" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" 
                            Padding="10,8" Margin="0,0,0,15">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Radio Buttons for Sheets/Views -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,15,0">
                                <RadioButton x:Name="SheetsRadio" Content="Sheets" IsChecked="True" GroupName="ViewType" 
                                             VerticalAlignment="Center" Margin="0,0,10,0" FontSize="12"
                                             Checked="SheetsRadio_Checked"/>
                                <RadioButton x:Name="ViewsRadio" Content="Views" GroupName="ViewType" 
                                             VerticalAlignment="Center" FontSize="12"
                                             Checked="ViewsRadio_Checked"/>
                            </StackPanel>

                            <!-- View/Sheet Set Label -->
                            <TextBlock Grid.Column="1" Text="View/Sheet Set" VerticalAlignment="Center" 
                                       Margin="0,0,8,0" FontSize="12"/>

                            <!-- Filter Checkbox + Dropdown -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,8,0">
                                <CheckBox x:Name="FilterByVSCheckBox" 
                                         VerticalAlignment="Center"
                                         Margin="0,0,6,0"
                                         Checked="FilterByVSCheckBox_Checked"
                                         Unchecked="FilterByVSCheckBox_Unchecked"
                                         ToolTip="Enable filtering by View/Sheet Set"/>
                                
                                <ComboBox x:Name="ViewSheetSetCombo" Width="140" Height="24" 
                                          SelectionChanged="ViewSheetSetCombo_SelectionChanged"
                                          BorderBrush="#CCCCCC" BorderThickness="1" Background="White"
                                          Padding="6,2" FontSize="12">
                                    <ComboBoxItem Content="Filter by V/S Sets" IsSelected="True"/>
                                    <ComboBoxItem Content="All Sheets"/>
                                    <ComboBoxItem Content="Architectural"/>
                                    <ComboBoxItem Content="Structural"/>
                                    <ComboBoxItem Content="MEP"/>
                                    <ComboBoxItem Content="Site"/>
                                </ComboBox>
                            </StackPanel>

                            <!-- Save V/S Set Button -->
                            <Button Grid.Column="3" Content="Save V/S Set" Width="90" Height="24" 
                                    Margin="0,0,10,0" FontSize="12"
                                    Background="White" BorderBrush="#CCCCCC" BorderThickness="1"
                                    Click="SaveVSSet_Click"
                                    ToolTip="Save current selection as View/Sheet Set">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="2" Padding="8,2">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#F0F0F0"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>

                            <!-- Search TextBox -->
                            <TextBox Grid.Column="5" x:Name="SearchTextBox" Width="200" Height="24" 
                                     VerticalContentAlignment="Center" FontSize="12"
                                     BorderBrush="#CCCCCC" BorderThickness="1"
                                     Padding="24,2,6,2"
                                     TextChanged="SearchTextBox_TextChanged">
                                <TextBox.Template>
                                    <ControlTemplate TargetType="TextBox">
                                        <Border Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="2">
                                            <Grid>
                                                <ScrollViewer x:Name="PART_ContentHost" 
                                                             Margin="{TemplateBinding Padding}"
                                                             VerticalAlignment="Center"/>
                                                <TextBlock Text="🔍" 
                                                          HorizontalAlignment="Left" 
                                                          VerticalAlignment="Center"
                                                          Margin="6,0,0,0"
                                                          Foreground="#999999"
                                                          IsHitTestVisible="False"
                                                          FontSize="12"/>
                                            </Grid>
                                        </Border>
                                    </ControlTemplate>
                                </TextBox.Template>
                            </TextBox>
                        </Grid>
                    </Border>

                    <!-- DataGrid -->
                    <DataGrid Grid.Row="3" x:Name="SheetsDataGrid" 
                              Style="{StaticResource HeaderlessDataGrid}"
                              ItemsSource="{Binding Sheets}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              CanUserResizeRows="False"
                              CanUserResizeColumns="True"
                              SelectionChanged="SheetsDataGrid_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Width="40" CanUserResize="False" Header="">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" 
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            <DataGridTextColumn Width="120" Binding="{Binding SheetNumber}" Header="Sheet Number" CanUserResize="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Margin" Value="10,8"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <DataGridTextColumn Width="*" Binding="{Binding SheetName}" Header="Sheet Name" CanUserResize="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Margin" Value="10,8"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <DataGridTextColumn Width="100" Binding="{Binding Revision}" Header="Revision" CanUserResize="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Margin" Value="10,8"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <DataGridTextColumn Width="120" Binding="{Binding PaperSize}" Header="Size" CanUserResize="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Margin" Value="10,8"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <DataGridTemplateColumn Width="*" CanUserResize="True">
                                <DataGridTemplateColumn.HeaderStyle>
                                    <Style TargetType="DataGridColumnHeader">
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Background" Value="#E8E8E8"/>
                                    </Style>
                                </DataGridTemplateColumn.HeaderStyle>
                                <DataGridTemplateColumn.Header>
                                    <Button Content="Custom File Name"
                                           HorizontalAlignment="Stretch"
                                           HorizontalContentAlignment="Left"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Padding="8,8"
                                           Cursor="Hand"
                                           FontWeight="SemiBold"
                                           Click="EditSelectedFilenames_Click"
                                           ToolTip="Click to edit filename for selected sheets">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}"
                                                                    BorderThickness="0"
                                                                    Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                                                                VerticalAlignment="Center"/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Background" Value="#D0D0D0"/>
                                                                </Trigger>
                                                                <Trigger Property="IsPressed" Value="True">
                                                                    <Setter Property="Background" Value="#C0C0C0"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </DataGridTemplateColumn.Header>
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding CustomFileName, UpdateSourceTrigger=PropertyChanged}" 
                                                Margin="8,5" 
                                                Background="Transparent" 
                                                BorderThickness="0"
                                                IsReadOnly="True"
                                                VerticalContentAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Views DataGrid -->
                    <DataGrid Grid.Row="3" x:Name="ViewsDataGrid" 
                              Style="{StaticResource HeaderlessDataGrid}"
                              ItemsSource="{Binding Views}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              CanUserResizeRows="False"
                              CanUserResizeColumns="True"
                              Visibility="Collapsed"
                              SelectionChanged="ViewsDataGrid_SelectionChanged">
                        <DataGrid.Columns>
                            <!-- Checkbox Column -->
                            <DataGridTemplateColumn Width="40" Header="" CanUserResize="False">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" 
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            <!-- View Name -->
                            <DataGridTextColumn Width="200" Binding="{Binding ViewName}" Header="View Name" CanUserResize="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Margin" Value="10,8"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!-- View Type Dropdown -->
                            <DataGridTemplateColumn Width="100" Header="All View" CanUserResize="True">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <ComboBox ItemsSource="{Binding AvailableViewTypes}"
                                                 SelectedItem="{Binding ViewType, UpdateSourceTrigger=PropertyChanged}"
                                                 BorderThickness="0"
                                                 Background="Transparent"
                                                 Padding="4,2"
                                                 Margin="4,0">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding}" FontSize="11"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            <!-- View Scale -->
                            <DataGridTextColumn Width="80" Binding="{Binding Scale}" Header="View Scale" CanUserResize="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Margin" Value="10,8"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <!-- Detail Level -->
                            <DataGridTextColumn Width="80" Binding="{Binding DetailLevel}" Header="Detail Level" CanUserResize="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Margin" Value="10,8"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <!-- Discipline -->
                            <DataGridTextColumn Width="100" Binding="{Binding Discipline}" Header="Discipline" CanUserResize="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Margin" Value="10,8"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <!-- Custom File Name (Editable) -->
                            <DataGridTemplateColumn Width="*" CanUserResize="True">
                                <DataGridTemplateColumn.HeaderStyle>
                                    <Style TargetType="DataGridColumnHeader">
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Background" Value="#E8E8E8"/>
                                    </Style>
                                </DataGridTemplateColumn.HeaderStyle>
                                <DataGridTemplateColumn.Header>
                                    <Button Content="Custom File Name"
                                           HorizontalAlignment="Stretch"
                                           HorizontalContentAlignment="Left"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Padding="8,8"
                                           Cursor="Hand"
                                           FontWeight="SemiBold"
                                           Click="EditSelectedFilenames_Click"
                                           ToolTip="Click to edit filename for selected views">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}"
                                                                    BorderThickness="0"
                                                                    Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                                                                VerticalAlignment="Center"/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Background" Value="#D0D0D0"/>
                                                                </Trigger>
                                                                <Trigger Property="IsPressed" Value="True">
                                                                    <Setter Property="Background" Value="#C0C0C0"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </DataGridTemplateColumn.Header>
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding CustomFileName, UpdateSourceTrigger=PropertyChanged}" 
                                                 Margin="8,5" Background="Transparent" BorderThickness="0"
                                                 IsReadOnly="True"
                                                 VerticalContentAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Bottom Status -->
                    <Grid Grid.Row="4" Margin="0,15,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Selection Statistics -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <Border Background="#E3F2FD" BorderBrush="#2196F3" BorderThickness="1" 
                                    CornerRadius="3" Padding="10,5" Margin="0,0,10,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="📄" FontSize="16" Margin="0,0,5,0"/>
                                    <TextBlock x:Name="SheetsCountText" Text="0 sheets selected" 
                                               FontWeight="SemiBold" Foreground="#1976D2"/>
                                </StackPanel>
                            </Border>
                            
                            <Border Background="#E8F5E8" BorderBrush="#4CAF50" BorderThickness="1" 
                                    CornerRadius="3" Padding="10,5" Margin="0,0,10,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="👁️" FontSize="16" Margin="0,0,5,0"/>
                                    <TextBlock x:Name="ViewsCountText" Text="0 views selected" 
                                               FontWeight="SemiBold" Foreground="#388E3C"/>
                                </StackPanel>
                            </Border>
                            
                            <Border Background="#FFF3E0" BorderBrush="#FF9800" BorderThickness="1" 
                                    CornerRadius="3" Padding="10,5">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="📊" FontSize="16" Margin="0,0,5,0"/>
                                    <TextBlock x:Name="TotalItemsText" Text="Total: 0 items" 
                                               FontWeight="SemiBold" Foreground="#F57C00"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                        
                        <!-- Action Buttons -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Content="Select All" Width="100" Height="40" Margin="0,0,5,0"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Click="SelectAll_Click"/>
                            <Button Content="Clear All" Width="100" Height="40" Margin="0,0,5,0"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Click="ClearAll_Click"/>
                            <Button Content="Refresh" Width="80" Height="40"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Click="Refresh_Click"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </TabItem>
            
            <!-- Format Settings Tab -->
            <TabItem x:Name="FormatsTab">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Fill="#FF9800" Width="8" Height="8" Margin="0,0,5,0"/>
                        <TextBlock Text="Formats"/>
                    </StackPanel>
                </TabItem.Header>
                
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Format Selection -->
                    <Border Grid.Row="0" Background="#F8F8F8" BorderBrush="#E1E1E1" BorderThickness="1" 
                            CornerRadius="3" Padding="15" Margin="0,0,0,15">
                        <StackPanel>
                            <TextBlock Text="Export Formats" FontWeight="SemiBold" Margin="0,0,0,10"/>
                            <WrapPanel>
                                <CheckBox Content="PDF" Margin="0,0,15,0" 
                                          IsChecked="{Binding ExportSettings.IsPdfSelected, Mode=TwoWay}"/>
                                <CheckBox Content="DWG" Margin="0,0,15,0" 
                                          IsChecked="{Binding ExportSettings.IsDwgSelected, Mode=TwoWay}"/>
                                <CheckBox Content="JPG" Margin="0,0,15,0" 
                                          IsChecked="{Binding ExportSettings.IsJpgSelected, Mode=TwoWay}"/>
                                <CheckBox Content="PNG" Margin="0,0,15,0" 
                                          IsChecked="{Binding ExportSettings.IsPngSelected, Mode=TwoWay}"/>
                                <CheckBox Content="IFC" Margin="0,0,15,0" 
                                          IsChecked="{Binding ExportSettings.IsIfcSelected, Mode=TwoWay}"/>
                                <CheckBox Content="Navisworks" Margin="0,0,15,0" 
                                          IsChecked="{Binding ExportSettings.IsNwcSelected, Mode=TwoWay}"/>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <!-- Format Settings Details -->
                    <TabControl Grid.Row="1" Background="White" BorderThickness="1" BorderBrush="#E1E1E1">
                        <TabItem Header="PDF Settings" IsEnabled="{Binding ExportSettings.IsPdfSelected}">
                            <Grid Margin="15">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                    <TextBlock Text="Paper Size:" Width="100" VerticalAlignment="Center"/>
                                    <ComboBox Width="150" SelectedItem="{Binding ExportSettings.PaperSize}">
                                        <ComboBoxItem Content="A3"/>
                                        <ComboBoxItem Content="A4"/>
                                        <ComboBoxItem Content="A2"/>
                                        <ComboBoxItem Content="A1"/>
                                        <ComboBoxItem Content="A0"/>
                                    </ComboBox>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                                    <TextBlock Text="DPI:" Width="100" VerticalAlignment="Center"/>
                                    <ComboBox Width="150" SelectedItem="{Binding ExportSettings.Resolution}">
                                        <ComboBoxItem Content="150"/>
                                        <ComboBoxItem Content="300"/>
                                        <ComboBoxItem Content="600"/>
                                    </ComboBox>
                                </StackPanel>
                                
                                <CheckBox Grid.Row="2" Content="Hide Crop Boundaries" 
                                          IsChecked="{Binding ExportSettings.HideCropBoundaries}"/>
                            </Grid>
                        </TabItem>
                        
                        <TabItem Header="DWG Settings" IsEnabled="{Binding ExportSettings.IsDwgSelected}">
                            <Grid Margin="15">
                                <StackPanel>
                                    <CheckBox Content="Export objects as AutoCAD blocks" Margin="0,0,0,10"
                                              IsChecked="{Binding ExportSettings.ExportAsBlocks}"/>
                                    <CheckBox Content="Use shared coordinates" Margin="0,0,0,10"
                                              IsChecked="{Binding ExportSettings.UseSharedCoordinates}"/>
                                    <CheckBox Content="Create separate files for each sheet" 
                                              IsChecked="{Binding ExportSettings.CreateSeparateFiles}"/>
                                </StackPanel>
                            </Grid>
                        </TabItem>
                    </TabControl>
                </Grid>
            </TabItem>
            
            <!-- Create Tab -->
            <TabItem x:Name="CreateTab">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Fill="#4CAF50" Width="8" Height="8" Margin="0,0,5,0"/>
                        <TextBlock Text="Create"/>
                    </StackPanel>
                </TabItem.Header>
                
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Output Folder Selection -->
                    <Border Grid.Row="0" Background="#F8F8F8" BorderBrush="#E1E1E1" BorderThickness="1" 
                            CornerRadius="3" Padding="15" Margin="0,0,0,15">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" Text="Output Folder" FontWeight="SemiBold" Margin="0,0,0,10"/>
                            
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBox Grid.Column="0" x:Name="OutputFolderTextBox" 
                                         Text="{Binding OutputFolder, UpdateSourceTrigger=PropertyChanged}"
                                         Height="35" VerticalContentAlignment="Center" 
                                         Margin="0,0,10,0" FontSize="13"/>
                                         
                                <Button Grid.Column="1" Content="Browse..." Width="80" Height="35"
                                        Click="BrowseOutputFolder_Click"
                                        Background="#2196F3" Foreground="White" BorderThickness="0"/>
                            </Grid>
                        </Grid>
                    </Border>

                    <!-- Selection Summary -->
                    <Border Grid.Row="1" Background="#F0F4FF" BorderBrush="#2196F3" BorderThickness="1" 
                            CornerRadius="3" Padding="15" Margin="0,0,0,15">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Selection Summary" FontWeight="SemiBold" Margin="0,0,0,5"/>
                                <TextBlock x:Name="SelectionSummaryText" Text="No items selected" 
                                           FontSize="13" Foreground="#666"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                <TextBlock Text="Export Formats" FontWeight="SemiBold" Margin="0,0,0,5"/>
                                <TextBlock x:Name="FormatSummaryText" Text="No formats selected" 
                                           FontSize="13" Foreground="#666"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Selected Items Preview -->
                    <Border Grid.Row="2" Background="White" BorderBrush="#E1E1E1" BorderThickness="1" 
                            CornerRadius="3">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <Border Grid.Row="0" Background="#F8F8F8" BorderBrush="#E1E1E1" 
                                    BorderThickness="0,0,0,1" Padding="15,10">
                                <TextBlock Text="Selected Items Preview" FontWeight="SemiBold"/>
                            </Border>
                            
                            <ListBox Grid.Row="1" x:Name="SelectedItemsListBox" 
                                     BorderThickness="0" Margin="10"
                                     ItemsSource="{Binding SelectedItemsForExport}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="5">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="120"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="150"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <Ellipse Grid.Column="0" Fill="#4CAF50" Width="8" Height="8" 
                                                     VerticalAlignment="Center" Margin="0,0,10,0"/>
                                            <TextBlock Grid.Column="1" Text="{Binding Number}" FontWeight="SemiBold" 
                                                       VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" Text="{Binding Name}" 
                                                       VerticalAlignment="Center" Margin="10,0"/>
                                            <TextBlock Grid.Column="3" Text="{Binding CustomFileName}" 
                                                       FontStyle="Italic" Foreground="#666"
                                                       VerticalAlignment="Center"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </Border>

                    <!-- Create Button -->
                    <Button Grid.Row="3" Content="CREATE FILES" Height="45" 
                            FontSize="14" FontWeight="SemiBold"
                            Background="#4CAF50" Foreground="White" BorderThickness="0"
                            Margin="0,15,0,0" Click="CreateFiles_Click">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" 
                                                    CornerRadius="3" BorderThickness="0">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                  VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#45A049"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Bottom Section -->
        <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="0,1,0,0" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Button Grid.Column="1" x:Name="BackButton" Content="Back" 
                        Style="{StaticResource SecondaryButtonStyle}"
                        Width="80" Height="40" Margin="0,0,10,0"
                        IsEnabled="False"
                        Click="BackButton_Click"/>
                <Button Grid.Column="2" x:Name="NextButton" Content="Next" 
                        Style="{StaticResource PrimaryButtonStyle}"
                        Width="80" Height="40"
                        Click="NextButton_Click"/>
            </Grid>
        </Border>
    </Grid>
</Window>